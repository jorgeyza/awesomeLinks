import { useRouter } from 'next/router';
import { useEffect, useState } from 'react';
import { motion } from 'framer-motion';

const PageLoader = () => {
  const router = useRouter();

  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const handleStart = (url: string) => url !== router.asPath && setLoading(true);
    const handleComplete = (url: string) => url === router.asPath && setLoading(false);

    router.events.on('routeChangeStart', handleStart);
    router.events.on('routeChangeComplete', handleComplete);
    router.events.on('routeChangeError', handleComplete);

    return () => {
      router.events.off('routeChangeStart', handleStart);
      router.events.off('routeChangeComplete', handleComplete);
      router.events.off('routeChangeError', handleComplete);
    };
  });

  return (
    (loading && (
      <motion.svg
        animate={{ rotate: 0, transition: { duration: 1 } }}
        fill='none'
        height='39'
        initial={{ rotate: -180 }}
        viewBox='0 0 38 39'
        width='38'
        xmlns='http://www.w3.org/2000/svg'>
        <g clipPath='url(#clip0)'>
          <path
            d='M35.0004 10.05C34.8371 9.8283 34.749 9.56024 34.749 9.28496C34.749 9.00967 34.8371 8.74161 35.0004 8.51996C35.6931 7.34569 35.937 5.96025 35.6869 4.62001C35.4369 3.27977 34.7099 2.07547 33.6404 1.22995C32.6225 0.38526 31.327 -0.0508213 30.0056 0.00647135C28.6842 0.063764 27.4312 0.610338 26.4904 1.53995C26.2882 1.75725 26.0209 1.90301 25.7287 1.95531C25.4366 2.00761 25.1354 1.96362 24.8704 1.82995C22.1388 0.928938 19.238 0.661885 16.3878 1.04906C13.5377 1.43623 10.8132 2.46745 8.42102 4.06449C6.02883 5.66153 4.03181 7.78243 2.58145 10.2663C1.13109 12.7501 0.2655 15.5317 0.0503509 18.4C-0.769649 29.85 8.55035 39.16 18.9304 38.87C19.8155 38.8684 20.7 38.8217 21.5804 38.73C24.6736 38.2534 27.6018 37.0225 30.1065 35.1459C32.6112 33.2694 34.6153 30.8049 35.9417 27.9702C37.2681 25.1355 37.8761 22.0177 37.7119 18.8924C37.5477 15.767 36.6165 12.7301 35.0004 10.05V10.05ZM21.4404 36.13C19.0972 36.5084 16.6997 36.3709 14.4151 35.727C12.1306 35.0831 10.0141 33.9483 8.2135 32.4019C6.41286 30.8555 4.97144 28.9348 3.98985 26.7737C3.00826 24.6127 2.51017 22.2634 2.53035 19.89C2.53035 8.74995 13.2803 0.739955 23.7104 4.09995C24.4304 4.32995 24.7104 4.51995 24.7104 5.41995C24.6566 6.30616 24.8171 7.19228 25.1781 8.00339C25.5391 8.81449 26.0902 9.52675 26.7846 10.0799C27.479 10.6331 28.2964 11.011 29.1677 11.1816C30.039 11.3521 30.9386 11.3104 31.7904 11.06C32.4904 10.88 32.7303 11.06 33.0303 11.56C34.3753 13.8703 35.1384 16.473 35.2538 19.1438C35.3693 21.8146 34.8337 24.4734 33.6932 26.8912C32.5527 29.309 30.8415 31.4133 28.707 33.0227C26.5724 34.6322 24.0786 35.6985 21.4404 36.13Z'
            fill='#0E2871'
          />
          <path
            d='M18.9405 9.8501C16.2883 9.8501 13.7448 10.9037 11.8694 12.779C9.99403 14.6544 8.94046 17.1979 8.94046 19.8501C8.89098 21.1806 9.10928 22.5074 9.58241 23.7519C10.0555 24.9964 10.7739 26.1331 11.6947 27.0947C12.6156 28.0563 13.7203 28.823 14.9431 29.3495C16.166 29.8759 17.4822 30.1513 18.8136 30.1594C20.1449 30.1674 21.4643 29.9079 22.6935 29.3963C23.9226 28.8846 25.0365 28.1313 25.9689 27.1809C26.9013 26.2305 27.6333 25.1025 28.1214 23.8639C28.6096 22.6252 28.8439 21.3011 28.8105 19.9701C28.8425 17.3196 27.8209 14.7648 25.9701 12.8672C24.1194 10.9695 21.5909 9.88436 18.9405 9.8501V9.8501Z'
            fill='#0E2871'
          />
        </g>
        <defs>
          <clipPath id='clip0'>
            <rect fill='white' height='38.87' width='37.75' />
          </clipPath>
        </defs>
      </motion.svg>
    )) ||
    null
  );
};

export default PageLoader;
